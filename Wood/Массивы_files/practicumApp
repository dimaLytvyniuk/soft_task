(function(){function n(n){function t(t){return n({url:"/api/practicums/"+t+"/lessons",method:"GET"})}function i(t){return n({url:"/api/practicums/"+t,method:"GET"})}return{getLessonsData:t,getPracticumData:i}}function t(n){function t(){return n({url:"api/user/info",method:"GET"})}return{getStatistics:t}}angular.module("itvdnPracticum",["ui.ace","pasvaz.bindonce","ngRoute"]).constant("viewsPath","/Content/public/partialViews/").factory("lessonsService",n).service("userStatisticsService",t).config(["$routeProvider","$locationProvider","viewsPath",function(n,t,i){n.when("/catalog",{pageTitle:"Каталог",headerTitle:"Каталог",templateUrl:i+"catalog.html"}).when("/lessons/:Id",{pageTitle:"Описание",headerTitle:"",templateUrl:i+"lessons.html",controller:"lessonsCtrl",controllerAs:"lessonsCtrl",resolve:{initialData:["lessonsService","$q","$route",function(n,t,i){function u(){var i=t.defer();return n.getLessonsData(r).then(function(n){i.resolve(n)}),i.promise}function f(){var i=t.defer();return n.getPracticumData(r).then(function(n){i.resolve(n)}),i.promise}var r=i.current.params.Id;return t.all([u(),f()]).then(function(n){return{lessonsInfo:n[0],practicumInfo:n[1]}})}]}}).when("/",{pageTitle:"Каталог",templateUrl:i+"catalog.html"}).when("/examination/:id",{pageTitle:"Практикум",templateUrl:i+"examination.html"})}]).run(["$location","$rootScope","userStatisticsService",function(n,t,i){function r(n,t){if(t.hasOwnProperty("$$route")){var r=angular.element("#header-title"),u=angular.element("#page-title"),f=angular.element("#scoresBlock");u&&u.text(t.$$route.pageTitle);r&&r.text(t.$$route.headerTitle);f&&i.getStatistics().then(function(n){f.text(n.data.totalUserScores)})}}function u(n,t){var u=angular.element("#header-title"),f=angular.element("#page-title"),r=angular.element("#scoresBlock");t.title&&f.text(t.title);t.title&&u.text(t.title);r&&i.getStatistics().then(function(n){r.text(n.data.totalUserScores)})}t.$on("$routeChangeSuccess",r);t.$on("updateHeader",u)}]);n.$inject=["$http"];t.$inject=["$http"]})(),function(){"use strict";angular.module("itvdnPracticum").directive("scrollIf",function(){return{scope:!1,link:function(n,t,i){n.$watch(i.changesTriger,function(n){if(i.scrollIf===n.id){var r=angular.element("#task-section");r.animate({scrollTop:t[0].offsetTop-70},500)}})}}})}(),function(){function n(n){function t(){return n({url:"api/user/info",method:"GET"})}return{getStatistics:t}}angular.module("itvdnPracticum").factory("userStatisticsService",n);n.$inject=["$http"]}(),function(){function n(n){var t="";n.searchTag="";n.getComplexity=function(){return t};n.setComplexity=function(n){t=n};n.createCookie=function(n,t,i){var u,r;i?(r=new Date,r.setTime(r.getTime()+i*864e5),u="; expires="+r.toGMTString()):u="";document.cookie=n+"="+t+u+"; path=/"};n.getCookie=function(n){return document.cookie.length>0&&(c_start=document.cookie.indexOf(n+"="),c_start!=-1)?(c_start=c_start+n.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""};n.closeForumPanelInfo=function(t){t.preventDefault();$(".forum-panel-info").slideUp(200,function(){n.createCookie("forumPanel","no_show",14);n.$digest()})};n.isForumMessage=function(){return n.getCookie("forumPanel")!=="no_show"}}angular.module("itvdnPracticum").controller("catalogCtrl",n);n.$inject=["$scope"]}(),function(){function n(n,t,i){t.$emit("updateHeader",{title:i.practicumInfo.data.practicumInfo.name});n.lessonsInfo=i.lessonsInfo.data;n.practicumInfo=i.practicumInfo.data;n.title=n.totalScore=function(){var i=n.lessonsInfo,r=0,t=0;for(t;t<i.length;t++)r+=i[t].lesson.maxTasksScore;return r};n.show=function(){};n.getPointsPercent=function(){return n.practicumInfo.practicumInfo.lessonsCount==0?0:n.practicumInfo.userPracticumInfo.comletedLessons*100/n.practicumInfo.practicumInfo.lessonsCount};n.getProgresPercent=function(){return n.practicumInfo.userPracticumInfo.totalScores*100/n.totalScore()};n.getPointsOpacity=function(){return n.practicumInfo.userPracticumInfo.totalScores/n.totalScore()<=.3?.3:n.practicumInfo.userPracticumInfo.totalScores/n.totalScore()};n.getProgressOpacity=function(){return n.practicumInfo.userPracticumInfo.comletedLessons/n.practicumInfo.practicumInfo.lessonsCount<=.3?.3:n.practicumInfo.userPracticumInfo.comletedLessons/n.practicumInfo.practicumInfo.lessonsCount};n.resolveUrl=function(){for(var u,r="",i=n.lessonsInfo,t=0;t<i.length;t++)if(u=i[t].lesson.tasksCount,u>0&&(i[t].userLessonInfo.lessonStatus=="InProgress"||i[t].userLessonInfo.lessonStatus=="None"&&i[t].isAccessible)){r=i[t].lesson.id;break}return r};n.generateRefForLesson=function(t,r){var f="#lessons/"+i.practicumInfo.data.practicumInfo.id,u=n.lessonsInfo;return u[t].userLessonInfo.lessonStatus!=="None"||t>=1&&u[t-1].userLessonInfo.lessonStatus==="Finished"&&u[t].isAccessible||t==0&&u[t].isAccessible?(f=u[t].lesson.id,r+f):f}}angular.module("itvdnPracticum").controller("lessonsCtrl",n);n.$inject=["$scope","$rootScope","initialData"]}(),function(){function n(n,t){(function(){function i(t){n.userStatistic=t}function r(){alert("Ошибка соединения с сервером!")}t.getStatistics().then(i,r)})()}angular.module("itvdnPracticum").controller("rootCtrl",n);n.$inject=["$scope","userStatisticsService"]}(),function(){function n(n,t){function r(){return n.get("/api/practicums").then(function(n){return i=n.data})}function u(){return angular.isDefined(i)?t(function(n){n(i)}):r()}var i;return{catalogItems:u}}angular.module("itvdnPracticum").factory("catalogService",n);n.$inject=["$http","$q"]}(),function(){function n(n,t){function r(t){var r="/api/practicums/"+t+"/lessons";return n.get(r).then(function(n){return i[t]=n.data,i[t]})}function u(n){return angular.isDefined(i[n])?t(function(t){t(i[n])}):r(n)}function f(t){return n.post("/api/tasks/"+t+"/close",JSON.stringify(t)).then(function(n){return n.data})}function e(t){return n.post("/api/lessons/"+t+"/close",JSON.stringify(t)).then(function(n){return n.data})}function o(t){return n.get("/api/lessons/"+t).then(function(n){return n.data})}var i={};return{fail:f,closeLesson:e,refresh:r,getModel:u,findLesson:o}}angular.module("itvdnPracticum").factory("practicumModelService",n);n.$inject=["$http","$q"]}(),function(){function n(n,t){function u(t){var i="/api/lessons/"+t+"/tasks";return n.get(i).then(function(n){return n.data})}function r(t,r){var u={content:r},f="/api/tasks/"+t+"/check";return n.post(f,JSON.stringify(u)).then(function(n){return i[t]=n.data,i[t]})}function f(n,u){return angular.isDefined(i[n])?t(function(t){t(i[n])}):r(n,u)}function e(t){var i="/api/tasks/"+t+"/start";return n.post(i).then(function(n){return n.data})}function o(t){var i="/api/tasks/"+t+"/close";return n.post(i).then(function(n){return n.data})}var i={};return{getTasks:u,getAnswer:r,checkAnswer:f,closeTask:o,startTask:e}}angular.module("itvdnPracticum").factory("answerAssessmentService",n);n.$inject=["$http","$q"]}(),function(){function n(){function n(n,t){n.filterComplexity=function(t){var i=n.$parent.getComplexity();return i!==""?t.difficultyLevel===i:!0};n.filterTags=function(t){var r=n.$parent.searchTag,i;if(r!==""){for(i=0;i<t.tags.length;i++)if(t.tags[i].value.indexOf(r)>-1)return!0;return!1}return!0};t.catalogItems().then(function(t){n.catalog=t})}return n.$inject=["$scope","catalogService"],{restrict:"E",scope:{catalog:"@"},controller:n,templateUrl:"/Scripts/Practicum/Directives/catalog/catalogTemplate.html"}}angular.module("itvdnPracticum").directive("catalogInfo",n)}(),function(){function n(n){function t(t,i){var r={text:i},u="/api/tasks/"+t+"/feedback";return n.post(u,JSON.stringify(r)).then(function(n){console.log(n)})}return{send:t}}angular.module("itvdnPracticum").factory("feedbackService",n);n.$inject=["$http"]}(),function(){function n(n,t,i,r,u,f,e,o){function w(){n.currentUserTask.currentHint+1>=n.currentTask.hintsCount?n.currentUserTask.currentHint=0:n.currentUserTask.currentHint+=1}function d(t){var i,r,u;for(n.ind=0,n.userName=v,n.id=l,n.data=t,i=0;i<n.data.length;i++)n.data[i].userTaskInfo.currentHint=n.data[i].userTaskInfo.usedHints;for(i=0;i<n.data.length;i++)if(n.data[i].userTaskInfo==null||n.data[i].userTaskInfo.taskStatus=="InProgress"){n.ind=i;break}n.modelLoaded=!0;n.currentTask=n.data[n.ind].task;n.practicumId=n.data[0].practicumId;n.currentUserTask=n.data[n.ind].userTaskInfo;b=n.currentTask.programmingLanguage.toLowerCase();r="#task-details__area"+n.ind;u=new Tour({storage:window.localStorage,template:"<div class='popover tour'><div class='arrow'><\/div><h3 class='popover-title'><\/h3><div class='popover-content'><\/div><div class='popover-navigation'><div class='btn-group'><button class='btn btn-sm btn-default' data-role='prev'>« Пред<\/button> <button class='btn btn-sm btn-default tour-disable-float' data-role='next'>След »<\/button><\/div><button class='btn btn-sm btn-default' data-role='end'>Завершить<\/button><\/div>",steps:[{backdrop:!0,element:"#tasksList",title:"Задачи",content:"Список задач, которые входят в практикум",smartPlacement:!0},{backdrop:!0,element:"#task-details__area",title:"Информация о прохождении",content:"Здесь вы можете увидеть макс. кол-во баллов за задачу и количество ваших попыток на то, чтобы ее выполнить",smartPlacement:!0},{element:r+" #gold",title:"Баллы",content:"Максимальное количество баллов, которые можно получить за задачу",smartPlacement:!0},{element:r+" .progress-wrapper",title:"Текущее количество баллов",content:"Баллы, которые Вы заработаете с вычетом допущенных ошибок и использованных подсказок",smartPlacement:!0},{element:r+" #attempt-num",title:"Количество попыток",content:"Количество попыток, использованных для прохождения задачи",smartPlacement:!0},{backdrop:!0,element:"#code-editor__window",title:"Редактор кода",content:"Текствый редактор, в котором вы можете вводить ответы или писать код",smartPlacement:!0},{element:"#change__theme__dark",title:"Смена темы",content:"Здесь вы сможете сменить тему графического редактора",smartPlacement:!0},{backdrop:!0,element:"#task-paginator",title:"Панель задач",content:"Эта панель нужна для перехода между задачами",smartPlacement:!0},{backdrop:!0,element:"#send__btn",title:"Отзыв",content:"Воспользуйтесь этой кнопкой, чтобы сообщить нам об ошибке в задании или высказать пожелание",smartPlacement:!0},{backdrop:!0,element:"#hint__btn",title:"Подсказка",content:"Если у Вас возникли проблемы с решением, Вы можете взять подсказку. Обратите внимание - количество подсказок ограничено и за каждую взятую подсказку Вы будете терять один балл",smartPlacement:!0},{backdrop:!0,element:"#check-exercise__btn",title:"Проверка ответа",content:"Если Вы хотите завершить задание - нажмите на кнопку проверки.",smartPlacement:!0},{element:"#scoresBlock",title:"Баллы",content:"Баллы полученые за прохождение всех практикумов",smartPlacement:!0}]});u.init();u.start();a()}function h(t){console.log("Ошибка при подключении к сервису. ");t.status===402&&n.showPaymentWindow();n.disableButton=!0}function a(){n.editor.getSession().setMode("ace/mode/"+n.currentTask.programmingLanguage.toLowerCase());var t=n.editor.getValue();t===""&&n.editor.setValue(n.currentUserTask.lastAnswer||n.currentTask.code||"",-1);try{if(n.currentUserTask.taskStatus==="None"||n.currentUserTask==null){f.startTask(n.currentTask.id).then(i,h);function i(t){n.data[n.ind].userTaskInfo={};n.data[n.ind].userTaskInfo=t;n.currentUserTask=n.data[n.ind].userTaskInfo}}}catch(r){}}function g(t){if(n.totalUserScores=t.totalUserScores,n.currentUserTask.potentialScores=t.potentialScores,n.currentUserTask.attempts=t.attempts,n.disableButton=!1,t.correct===!0)angular.element("#success_alert").css("visibility","visible"),angular.element("#success_alert").addClass("animated bounceIn"),setTimeout(function(){angular.element("#success_alert").css("visibility","hidden");angular.element("#success_alert").removeClass("animated bounceIn")},1500),nt(t);else return n.lockDesktop(!0),y(),n.wrongAnswer=!0,n.isError=!0,!1}function nt(t){n.editor.setValue("",-1);n.serverData=t;n.data[n.ind].userTaskInfo.taskStatus="Finished";$("#points").fadeIn(200);$("#points").fadeOut(1800);n.disableButton=!1;p()}function y(){n.data[n.ind].userTaskInfo.taskStatus="InProgress";n.disableButton=!1}function p(){n.isError=!1;c.eq(n.ind).removeClass("disactive");c.eq(n.ind).addClass("passed");n.ind++;c.eq(n.ind).removeClass("disactive");c.eq(n.ind).addClass("passed");n.ind<n.data.length?(n.currentTask=n.data[n.ind].task,n.currentUserTask=n.data[n.ind].userTaskInfo,n.editor.focus(),a()):n.finishPracticum()}function tt(t){n.finish=!0;n.response=t}var s=this,l,b,v,k,c;n.modelLoaded=!1;n.isError=!1;n.showGifHint=!1;s.paymentWindowIsOpen=!1;s.isScreenLocked=!1;n.feedback={};n.resetEditor=function(){n.currentUserTask.lastAnswer="";n.editor.setValue(n.currentTask.code)};n.feedbackIsOpen=!1;n.lockFeedbackSent=!1;n.showFeedbackWindow=function(){n.feedbackIsOpen=!0;n.lockFeedbackSent=!1};n.sendFeedback=function(){o.send(n.currentTask.id,n.feedback.text).then(function(){n.lockFeedbackSent=!0})};n.closeFeedback=function(){n.feedbackIsOpen=!1;n.feedback={}};n.isVisibleHint=!1;n.hideHint=function(){n.isVisibleHint=!1;n.lockDesktop(!1)};n.showHint=function(t){n.showGifHint=!0;n.currentUserTask.usedHints>=n.currentTask.hintsCount?(w(),taskReponce=e({method:"GET",url:"/api/tasks/"+t+"/hint?hintPosition="+n.currentUserTask.currentHint})):taskReponce=e({method:"GET",url:"/api/tasks/"+t+"/hint"});taskReponce.then(function(t){n.showGifHint=!1;n.isVisibleHint=!0;n.lockDesktop(!0);t.data&&(n.outOfLimit=!1,n.hint=t.data.text,n.currentUserTask.usedHints<n.currentTask.hintsCount&&(t.data!==!1&&(n.currentUserTask.potentialScores=t.data.potentialScores),n.position=t.data.position,n.currentUserTask.currentHint=t.data.position,n.currentUserTask.usedHints=t.data.position+1))},function(){n.lockDesktop(!1)})};n.practicumId="";l=i.current.params.id;v=angular.element("#userName").val();f.getTasks(l).then(d,h).then(n.aceLoaded);u.findLesson(l).then(function(n){t.$emit("updateHeader",{title:n.lesson.name})});s.hasAccess=function(t){if(n.data&&!(t<0))return!(n.data[t].userTaskInfo.taskStatus==="None")};n.showPaymentWindow=function(){s.isScreenLocked=!0;s.paymentWindowIsOpen=!0};n.lockDesktop=function(n){typeof n=="boolean"&&(s.isScreenLocked=n)};n.code="";n.taskStatusCheck=function(n){return n.userTaskInfo==null?!1:{falseAnswer:n.userTaskInfo.taskStatus=="Failed",trueAnswer:n.userTaskInfo.taskStatus=="Finished"}};n.rowStatusCheck=function(t,i){return t.userTaskInfo==null?{disactive:!0,active:n.ind===i}:{passed:t.userTaskInfo.taskStatus=="Failed"||t.userTaskInfo.taskStatus=="Finished",disactive:t.userTaskInfo.taskStatus=="InProgress",active:n.ind===i}};n.finishExercise=function(){k=angular.element(document.querySelectorAll("div.task-mark"));c=angular.element(document.querySelectorAll("div.about-task"));n.disableButton=!0;n.answer=n.editor.getValue();n.currentUserTask.lastAnswer=n.answer;a();f.getAnswer(n.currentTask.id,n.answer).then(g,h);n.currentTask.taskType==="FindError"?$("#code1 textarea").focus():$("#code3 textarea").focus()};n.backToTask=function(){n.lockDesktop(!1);n.isError=!1;n.wrongAnswer=!1;n.editor.focus()};n.continueExercise=function(){n.lockDesktop(!1);n.isError=!1;n.editor.setValue("",-1);n.disableButton=!0;f.closeTask(n.currentTask.id).then(y,h).then(p,h);n.wrongAnswer=!1};n.returnExercise=function(t,i){if(n.ind!==i&&s.hasAccess(i)&&i<n.data.length&&i>=0){if(t)var r=$(t.target).parent().hasClass("disactive");r||(n.currentTask=n.data[i].task,n.currentUserTask=n.data[i].userTaskInfo,n.ind=i,n.editor.setValue(n.currentUserTask.lastAnswer||n.currentTask.code||"",-1),a())}};s.isActive=function(t){return n.currentTask.id===t};n.finishPracticum=function(){u.closeLesson(n.id).then(tt,h)};n.bactToPracticum=function(){n.finish=!1;n.ind-=1};n.aceLoaded=function(t){n.editor=t;var i=t.getSession(),r=t.renderer;t.setReadOnly(!1);t.setTheme("ace/theme/monokai");t.setOptions({fontFamily:"Courier New",fontSize:"15px"});n.editor.on("blur",function(){n.currentUserTask.lastAnswer=n.editor.getValue()});i.setUseWrapMode(!0);i.setUseWorker(!1);i.setUndoManager(new ace.UndoManager);r.setShowGutter(!0)};n.changeThemeToLight=function(){n.editor.setTheme("ace/theme/dawn")};n.changeThemeToDark=function(){n.editor.setTheme("ace/theme/monokai")}}angular.module("itvdnPracticum").controller("itvdnPracticumCtrl",n);n.$inject=["$scope","$rootScope","$route","$sce","practicumModelService","answerAssessmentService","$http","feedbackService"]}();angular.module("itvdnPracticum").directive("itvdnFeedbackForm",["$http",function(n){var t=["$scope",function(t){var i;t.isVisible=!1;t.hideWindow=function(){t.isVisible=!1};t.showWindow=function(){t.showComment=!0;t.isVisible=!0};t.moreComment=function(){t.showComment=!0;i.val("")};t.sendReqest=function(r){if(i=angular.element(document.querySelector(".userComment")),i.val().length==0)return!1;t.showGif=!0;i=angular.element(document.querySelector(".userComment"));n({method:"POST",url:"/Practicums/LeaveFeedback",data:{taskId:r,messageText:i.val()}}).then(function(){t.showGif=!1;t.showComment=!t.showComment},function(){})}}];return{restrict:"EAC",templateUrl:"/Scripts/Practicum/Directives/itvdn-feedback-form/itvdnFeedbackFormTemplate.html",controller:t}}]),function(){"use strict";function n(n){function t(){n.$emit("startObserve",{someProp:"Sending you an Object!"})}return{compile:t,scope:!1,restrict:"EA",templateUrl:"/Scripts/Practicum/Directives/task-details/taskDetailsTemplate.html"}}angular.module("itvdnPracticum").directive("taskDetails",n);n.$inject=["$rootScope"]}();angular.module("itvdnPracticum").directive("itvdnHint",["$http",function(){var n=["$scope",function(){}];return{restrict:"EA",templateUrl:"/Scripts/Practicum/Directives/itvdn-hint/template.html",controller:n,scope:!1}}]),function(){function n(n){return{link:function(){n(function(){var n=angular.element(document.getElementsByClassName("active")[0]);n.addClass("passed");n.removeClass("disactive")},0)},restrict:"EAC"}}angular.module("itvdnPracticum").directive("collectElements",n);n.$inject=["$timeout"]}(),function(){function n(n,t){function i(n){n.resolveTaskClass=function(n){return n.userTaskInfo.taskStatus==="InProgress"&&n.userTaskInfo.attempts>0||n.userTaskInfo.taskStatus==="Failed"&&n.userTaskInfo.attempts>0?!1:n.userTaskInfo.taskStatus==="Finished"?!0:null}}return i.$inject=["$scope"],{scope:!1,link:function(n,i,r){function f(){n.$watch(r.changesTriger,function(n){if(n){var r=$(".full-task").slideUp(300),i="#"+n.id,t=angular.element(i),u=$(t).next().next().slideDown(300);t.toggleClass("active-task")}})}var u=t.$on("startObserve",function(){f()});t.$on("$destroy",u)},controller:i,templateUrl:"/Scripts/Practicum/Directives/examination-task/examinationTaskTemplate.html"}}angular.module("itvdnPracticum").directive("examinationTask",n);n.$inject=["$timeout","$rootScope"]}(),function(){function n(n){return{restrict:"A",link:function(t,i){t.isLoading=function(){return n.pendingRequests.length>0};t.$watch(t.isLoading,function(n){n?i.show():i.hide()})}}}angular.module("itvdnPracticum").directive("loader",n);n.$inject=["$http"]}(),function(){function n(){function n(n,t){n.catalog=t.catalogItems()}return n.$inject=["$scope","catalogService"],{restrict:"E",scope:!1,controller:n,templateUrl:"/Scripts/Practicum/Directives/exerciseList/exirciseListTemplate.html"}}angular.module("itvdnPracticum").directive("exerciseList",n)}(),function(){function n(n,t){return{link:function(i,r,u){function h(u){n(u).then(function(n){var u=angular.element(n);r.parent().prepend(t(u)(i));r.remove()})}var f,e,o,s;i.lessonIndex=u.lessonIndex;f=u.lessonStatus||"None";e=u.accessible==="true"?!0:!1;i.popupVisible=!1;i.getPassedClass=function(){return f==="Finished"?"passed":f==="InProgress"?"in-progress":""};o="/Scripts/Practicum/Directives/lesson-item-sign/number.html";s="/Scripts/Practicum/Directives/lesson-item-sign/lock.html";f==="Finished"||f==="InProgress"||f==="None"&&e?h(o):h(s)},restrict:"E",scope:{}}}angular.module("itvdnPracticum").directive("lessonItemSign",n);n.$inject=["$templateRequest","$compile"]}(),function(){function n(){function n(n,t){n.catalog=t.catalogItems()}return n.$inject=["$scope","catalogService"],{restrict:"E",scope:!1,controller:n,templateUrl:"/Scripts/Practicum/Directives/useful-resources/template.html"}}angular.module("itvdnPracticum").directive("usefulResources",n)}(),function(){function n(){function n(n,t){n.catalog=t.catalogItems()}return n.$inject=["$scope","catalogService"],{restrict:"E",scope:!1,controller:n,templateUrl:"/Scripts/Practicum/Directives/course-info/template.html"}}angular.module("itvdnPracticum").directive("courseInfo",n)}()